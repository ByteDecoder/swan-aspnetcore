<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title> Swan ASP.NET Core 3: Stuff We All Need | Unosquare SWAN ASPNetCore </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content=" Swan ASP.NET Core 3: Stuff We All Need | Unosquare SWAN ASPNetCore ">
    <meta name="generator" content="docfx 2.48.1.0">
    
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="stylesheet" href="styles/docfx.vendor.css">
    <link rel="stylesheet" href="styles/docfx.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/bootstrap.min.css">
    <meta property="docfx:navrel" content="toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="">
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container-fluid">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="index.html">
                <img id="logo" class="logo" src="best-practices/resources/images/unosquare_logo.svg" alt="Unosquare">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar">
          <div class="container-fluid hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container-fluid body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container-fluid body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">

<p><a href="https://ci.appveyor.com/project/geoperez/swan-aspnetcore/branch/master"><img src="https://ci.appveyor.com/api/projects/status/q408tg5jd9bm0jak/branch/master?svg=true" alt="Build status"></a>
<img src="https://github.com/unosquare/swan-aspnetcore/workflows/.NET%20Core%20CI/badge.svg" alt="Buils status">
<a href="https://coveralls.io/github/unosquare/swan-aspnetcore?branch=master"><img src="https://coveralls.io/repos/github/unosquare/swan-aspnetcore/badge.svg?branch=master" alt="Coverage Status"></a></p>
<h1 id="img-srchttpsgithubcomunosquareswanrawmasterswan-logo-32pngimg-swan-aspnet-core-3-stuff-we-all-need"><img src="https://github.com/unosquare/swan/raw/master/swan-logo-32.png"> Swan ASP.NET Core 3: Stuff We All Need</h1>
<p><em><span class="emoji" shortcode="star">⭐</span> Please star this project if you find it useful!</em></p>
<p>A set of libraries to use with ASP.NET Core 3.0 applications. Also, includes a configure middleware and extension to setup your project. ASP.NET Core 3.0 came with a lot of changes, including authentication and authorization, here with Swan ASP.NET Core 3.0 is easy to configure and start working on your project.</p>
<h2 id="nuget-installation">NuGet Installation:</h2>
<p><a href="https://badge.fury.io/nu/Unosquare.Swan.AspNetCore"><img src="https://badge.fury.io/nu/Unosquare.Swan.AspNetCore.svg" alt="NuGet version"></a></p>
<pre><code>PM&gt; Install-Package Unosquare.Swan.AspNetCore
</code></pre><h2 id="use-cases">Use Cases</h2>
<p>Here we can find a very useful code to use in our project configuration. All of this you can use it in your <code>Startup.cs</code> file, see our <a href="https://github.com/unosquare/swan-aspnetcore/tree/master/src/Unosquare.Swan.AspNetCore.Sample">Sample Project</a> for more reference.</p>
<h3 id="using-bearer-token-authentication">Using Bearer Token Authentication</h3>
<p>The extension method <code>AddBearerTokenAuthentication</code> adds the services that are going to be used in your application. This method uses the Jwt schemes and adds a JwtBearer with the Token Validation Parameters that you configure. Jwt stands for <a href="https://jwt.io/introduction/">JSON Web Tokens</a></p>
<p>The extension method <code>UseBearerTokenAuthentication</code> is important because it gives the application the requirements to use authentication and authorization with JWT.</p>
<p>With this configuration, you just need to add the data annotation <code>[Authorize]</code> to your API to say that the user needs to be authorized to access that part of your project.</p>
<p>This two are used together because you need to add the bearer token authentication to the services to use the bearer token authentication in your application. You just need to add in your <code>ConfigureServices</code> and your <code>Configure</code>.</p>
<pre><code class="lang-csharp">// This method gets called by the runtime. Use this method to add services to the container
public void ConfigureServices(IServiceCollection services)
{
    // Extension method to add Bearer authentication
    services.AddBearerTokenAuthentication(ValidationParameters);
}

// This method gets called by the runtime. Use this method to configure the HTTP request pipeline
public void Configure(IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFactory)
{
    // Use the bearer token provider and check Admin and Pass.word as valid credentials
    app.UseBearerTokenAuthentication(
        ValidationParameters,
        (services, username, password, grantType, clientId) =&gt;
        {
            if (username != &quot;Admin&quot; || password != &quot;Pass.word&quot;)
                return Task.FromResult&lt;ClaimsIdentity&gt;(null);

            var claim = new ClaimsIdentity(&quot;Bearer&quot;);
            claim.AddClaim(new Claim(ClaimTypes.Name, username));

            return Task.FromResult(claim);
        }, (identity, obj) =&gt;
        {
            // This action is optional
            obj[&quot;test&quot;] = &quot;OK&quot;;
            return Task.FromResult(obj);
        });
}
</code></pre><h3 id="using-entityframeworklogger">Using EntityFrameworkLogger</h3>
<p>The <code>EntityFrameworkLogger</code> represents a Logger based on Entity Framework and adds a Logging subsystem. It will help you log into your Database everything necessary to know what’s going on in your application. This logger is used in the <code>ConfigureServices</code> method of your Startup.cs file.</p>
<p>With this you just add your configuration section and then add in the entity framework, your database context and the models that you use for log entries into your database, then you just pass the application services.</p>
<pre><code class="lang-csharp">public void ConfigureServices(IServiceCollection services)
{
    // Inject your DbContext first.

        //  Add Entity Framework Logging Provider
    services.AddLoggingEntityFramework&lt;SampleDbContext, Models.LogEntry&gt;();
}
</code></pre><h3 id="using-businessdbcontext">Using BusinessDbContext</h3>
<p>The <code>BusinessDbContext</code> run business rules when you save changes to the database. It&#39;s helpful because if you want to modify an entity every time you save changes to the database, you can create a controller to do that. Your Db Context must inheritance from the BusinessDbContext in order to have this functionality and then you can add, remove and check for controllers using your context.</p>
<pre><code class="lang-csharp"> public class SampleDbContext : BusinessDbContext
    {
        public SampleDbContext(DbContextOptions&lt;SampleDbContext&gt; options)
            : base(options)
        {
        }
    }
</code></pre><h3 id="audittrail">AuditTrail</h3>
<p>Audit Trails is a business rule to save the changes to any operation performed in a record. In other words, capture what change between any data saving. This operation is important in many systems and you can accomplish with these extensions easily. The <code>AuditTrailController</code> can be attached to your <code>BusinessDbContext</code> and setup which Entities will be recorded in the three CRUD actions supported, create, update and delete.</p>
<pre><code class="lang-csharp">public class SampleDbContext : BusinessDbContext
    {
         public SampleDbContext(DbContextOptions&lt;SampleDbContext&gt; options, IHttpContextAccessor httpContextAccessor)
            : base(options)
        {
            var auditController = new AuditTrailController&lt;SampleDbContext, AuditTrailEntry&gt;(this,
                httpContextAccessor?.HttpContext?.User?.Identity?.Name);
            auditController.AddTypes(ActionFlags.Create, new[] {typeof(Product)});

            AddController(auditController);
        }

        public DbSet&lt;AuditTrailEntry&gt; AuditTrailEntries { get; set; }
    }
</code></pre><h3 id="additional-extension-methods">Additional Extension Methods</h3>
<p>Use the following extension methods to extend the <code>ApplicationBuilder</code> with helpful handlers.</p>
<h4 id="the-jsonexceptionhandler">The JsonExceptionHandler</h4>
<p>Adding this extension is a very good way to debug your application. When an error occurs, the exception handles the error and send a 500 Internal Server Error HTTP Response with a JSON object containing useful information as stacktrace and inner exceptions.</p>
<pre><code class="lang-csharp">// Response an exception as JSON at error
app.UseJsonExceptionHandler();
</code></pre><h4 id="the-fallback">The Fallback</h4>
<p>Redirect any 404 request without extension to specific URL like your <code>index.html</code> page. This is helpful when you are using client-side routing (like Angular) and redirect any unknown URL to the javascript application.</p>
<pre><code class="lang-csharp">// Redirect anything without extension to index.html
app.UseFallback();
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="doc" align="center">
              <span class="small mobile-hide">
                <img id="logo" class="doc-logo" src="swan-logo-256.png" alt="">
              </span>
            </div>
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li class="top-sep">
                    <a href="https://github.com/unosquare/swan-aspnetcore/blob/dependabot/nuget/System.IdentityModel.Tokens.Jwt-5.6.0/README.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2017-2019 <a href="https://www.unosquare.com">Unosquare</a></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="styles/docfx.js"></script>
    <script type="text/javascript" src="styles/main.js"></script>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-8535255-2', 'auto');
        ga('send', 'pageview');
    </script>
  </body>
</html>
